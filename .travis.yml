language: node_js
node_js: stable


branches:
  except:
    - /^v?\d+\.\d+\.\d+$/

before_install:
  - npm install -g bower polymer-cli

before_deploy:
  - "{ sed -nE 's/^[ \\t]*\"version\": \"([0-9]{1,}\\.[0-9]{1,}\\.)[0-9x]{1,}\",$/\\1/p' bower.json; git describe --tags | sed -E 's/^v([0-9]{1,}\\.[0-9]{1,}\\.)([0-9]{1,})/\\1 \\2/g'; } | tr \"\\n\" \" \" | awk '{printf($1==$2?\"v\"$2$3+1:\"v\"$1\"0\")}' | xargs -I {} bower version {} -m \"{}\"\n"
  - git tag
  - git config --local user.name "sbonnick"
  - git config --local user.email "stewart.bonnick@autoclavestudios.com"

deploy:
- provider: script
  skip_cleanup: true
  script: 
    - git push --tags https://$GITHUBKEY@github.com/sbonnick/caac-webcomponents

  on:
    branch: master